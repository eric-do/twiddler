<!DOCTYPE html>
<html>
  <head>
    <script src="jquery.js"></script>
    <script src="data_generator.js"></script>
    <script src="lib/moment.min.js"></script>
    <script src="lib/moment-with-locales.js"></script>
    <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Lato:100,300,400">
    <link rel="stylesheet" href="lib/main.css">
  </head>
  <body>
    <script>
      $(document).ready(function(){
        /* Set up body */
        var $body = $('body');
        var $tweetSection = $("<div></div>");
        $body.html('');
        $body.addClass("body");

        /* Load Tweet section */
        $tweetSection.addClass("tweet-section");
        $tweetSection.appendTo($body);

        /* Add post */
        var $addPost = $('<div></div>');
        var $tweetForm = $('<form action="#"></form>');
        $tweetForm.attr({'id':'tweet-form', 'method':'post', 'name':'tweet-form'});
        $tweetForm.addClass('tweet-form');
        $tweetForm.appendTo($addPost);
        var $newPostInput = $('<textarea></textarea>');
        $addPost.addClass('add-post-section');
        $addPost.appendTo($tweetSection);
        $newPostInput.addClass('tweet-field');
        $newPostInput.attr({'placeholder':'What\'s happening?', 'id' : 'new-post'});
        $newPostInput.appendTo($tweetForm);

        /* Click for new posts */
        var $reload = $("<p></p>").text("See new posts");
        $reload.addClass("tweet-card reload");
        $reload.appendTo($tweetSection);

        $reload.click(function() {
          location.reload();
        });

        /* Tweet container */
      /*  var $tweetContainer = $('<div></div>');
        $tweetContainer.addClass('tweet-container');
        $tweetContainer.appendTo($tweetSection);*/

        /* Display homepage tweets */
        outputTweets(streams.home);

        $(function() {
          $('#new-post').keypress(function(e){
            var message = $('#new-post').val();
            if (e.keyCode === 13 && !e.shiftKey){
              $('#new-post').val('');
              console.log('test');
            }
          });
        });

        $(function() {
          $('.user-link').click(function() {
            var username = this.text.substring(1);
            var tweetArray = streams.home.filter(function(tweet){
              return tweet.user === username;
            });
            console.log(tweetArray);
            outputTweets(tweetArray);
          });
        });


        function outputTweets(tweetArray) {
          $('.tweet-container').remove();
          $tweetContainer = $('<div></div>');
          $tweetContainer.addClass('tweet-container');
          for (var i = 0; i < tweetArray.length; i++) {
            var tweet = tweetArray[i];
            var $tweet = $('<div></div>');
            var $tweetText = $('<p>' + tweet.message + '</p>');
            var $avatar = $('<img class="avatar">');
            var avatarURL = 'https://api.adorable.io/avatars/285/' + tweet.user;
            var $username = $('<span class="username">@' + tweet.user + '</span>');
            var $userLink = $('<a></a>');
            var $tweetDate = $('<p>' + moment(tweet.date).startOf('hour').fromNow() + '</p>');
            $tweetDate.addClass('tweet-date content');
            $avatar.attr('src', avatarURL);
            $avatar.appendTo($tweet);
            $userLink.addClass('user-link');
            $userLink.appendTo($tweet);
            $username.addClass('content');
            $username.appendTo($userLink);
            $tweetDate.appendTo($tweet);
            $tweetText.appendTo($tweet);
            $tweetText.addClass('tweet-text content');
            $tweet.addClass("tweet tweet-card");
            $tweet.appendTo($tweetContainer);
          }
          $tweetContainer.appendTo($tweetSection);
        }
      });
    </script>
  </body>
</html>
